function ajax(e,t,a){const o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&200===o.status&&a(o.responseText)};const r=new FormData;r.append("file",t),o.open("post",e,!0),o.send(r)}function copyToClipboard(e){var t=document.getElementById(e.id).getAttribute("data-url"),a=document.createElement("textarea");a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="2em",a.style.height="2em",a.style.padding="0",a.style.border="none",a.style.outline="none",a.style.boxShadow="none",a.style.background="transparent",a.value=t,document.body.appendChild(a),a.select();try{var o=document.execCommand("copy"),r=o?"成功复制到剪贴板":"该浏览器不支持点击复制到剪贴板";alert(r)}catch(e){alert("该浏览器不支持点击复制到剪贴板")}document.body.removeChild(a)}const droppable=document.querySelector(".droppable"),list=document.querySelector(".list"),ball=document.querySelector(".ball"),filledBall=document.querySelector(".filled-ball"),hand=document.querySelector(".hand"),reader=new FileReader,formatBytes=(e,t=2)=>{if(0===e)return"0 Bytes";const a=1024,o=t<0?0:t,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,n)).toFixed(o))+r[n]};let isDragging=0;console.log("%c 小康博客 %c https://www.antmoe.com","color:red;font-weight:bold;font-size:3em","color:orange;font-weight:bold;font-size:3em"),document.addEventListener("dragover",e=>{e.preventDefault(),isDragging++,1===isDragging&&droppable.classList.add("is-dragging")}),document.addEventListener("drop",e=>{e.preventDefault(),isDragging=0,droppable.classList.remove("is-dragging")}),list.addEventListener("dragover",e=>{e.preventDefault()});const dragtl=gsap.timeline({paused:!0});dragtl.to(ball,{duration:.4,translateX:"286px",autoAlpha:1,translateY:"-230px"},"drag").to(hand,{duration:.4,transformOrigin:"right",rotate:"66deg",translateY:"70px",translateX:"-20px"},"drag"),list.addEventListener("dragenter",e=>{e.preventDefault(),droppable.classList.add("is-over"),dragtl.play()}),list.addEventListener("dragleave",e=>{e.preventDefault(),droppable.classList.remove("is-over"),dragtl.reverse()}),list.addEventListener("drop",e=>{e.preventDefault();let t=0;const{offsetX:a,offsetY:o}=e,{files:r}=e.dataTransfer;reader.readAsDataURL(r[0]),reader.addEventListener("load",()=>{t++,t>1||itemMarkup(r[0],reader.result,a,o)}),droppable.classList.remove("is-over")});const itemMarkup=(e,t,a,o)=>{const r=document.createElement("div"),n=Math.random().toString(36).substr(2,9);r.classList.add("item"),r.setAttribute("id",n),r.innerHTML=`<div class="item-img"><img src="${t}"/></div><div class="item-details"><div class="item-name">${e.name}</div><div class="item-size">SIZE:${formatBytes(e.size)}</div></div><button class="item-delete"data-id="${n}"></button><button class="item-delete item-url"id="${n}iAjue"onclick="copyToClipboard(this)">复制</button>`,list.append(r);const l=r.querySelector(".item-delete");l.addEventListener("click",e=>{e.stopPropagation(),deleteItem(e)});const i=r.querySelector(".item-img"),d=i.offsetLeft,s=i.offsetTop,c=document.createElement("div");c.classList.add("loaded-image"),c.innerHTML=`<img src="${t}"/><span><svg fill="#fff"xmlns="http://www.w3.org/2000/svg"viewBox="0 0 330 330"><path d="M165 7.5c-8.284 0-15 6.716-15 15v60c0 8.284 6.716 15 15 15 8.284 0 15-6.716 15-15v-60c0-8.284-6.716-15-15-15z"/><path d="M165 262.5c-8.284 0-15 6.716-15 15v30c0 8.284 6.716 15 15 15 8.284 0 15-6.716 15-15v-30c0-8.284-6.716-15-15-15z"/><path d="M315 157.5h-60c-8.284 0-15 6.716-15 15s6.716 15 15 15h60c8.284 0 15-6.716 15-15s-6.716-15-15-15z"/><path d="M90 172.5c0-8.284-6.716-15-15-15H15c-8.284 0-15 6.716-15 15s6.716 15 15 15h60c8.284 0 15-6.716 15-15z"/><path d="M281.673 55.827c-5.857-5.858-15.355-5.858-21.213 0l-42.427 42.427c-5.858 5.858-5.858 15.355 0 21.213 2.929 2.929 6.768 4.394 10.606 4.394 3.839 0 7.678-1.464 10.607-4.394l42.427-42.427c5.858-5.858 5.858-15.355 0-21.213z"/><path d="M90.753 225.533L48.328 267.96c-5.857 5.858-5.857 15.355 0 21.213 2.929 2.929 6.768 4.393 10.607 4.393 3.839 0 7.678-1.464 10.607-4.393l42.426-42.427c5.857-5.858 5.857-15.355 0-21.213-5.859-5.858-15.356-5.858-21.215 0z"/><path d="M69.541 55.827c-5.858-5.858-15.355-5.857-21.213 0-5.858 5.858-5.858 15.355 0 21.213l42.426 42.427c2.93 2.929 6.768 4.394 10.607 4.394 3.838 0 7.678-1.465 10.606-4.393 5.858-5.858 5.858-15.355 0-21.213L69.541 55.827z"/></svg></span>`,list.append(c);const p=gsap.timeline({onComplete:()=>{c.remove(),i.style.opacity=1,list.scrollTo(0,list.scrollHeight)}}),u=r.querySelectorAll("*:not(.item-img)"),g=c.querySelector("img"),m=c.querySelector("span");r.offsetLeft,r.offsetTop;ajax("update.php",e,function(e){if(e=JSON.parse(e),console.log(e),0==e.code){const t=r.querySelector(".item-url");t.setAttribute("data-url",e.msg),t.addEventListener("click",function(e){e.stopPropagation()},!1)}else alert(e.msg),r.querySelector(".item-delete").click()}),p.set(droppable,{pointerEvents:"none"}).fromTo(c,{autoAlpha:1,width:20,height:20,x:a-10,y:o-10,borderRadius:"50%"},{duration:.3,width:70,height:70,x:a-30,y:o-30}).to(m,{autoAlpha:1,duration:.4},"loading").to(c,{rotation:720,duration:1.2},"loading").to(m,{autoAlpha:0,duration:.4}).to(g,{autoAlpha:1,duration:.4},"-=.1").to(c,{x:d,y:s,duration:.8,autoAlpha:1,width:60,height:48,borderRadius:4},"-=.5").set(i,{autoAlpha:1}).fromTo(u,{autoAlpha:0,y:30},{autoAlpha:1,y:0,duration:.3,stagger:.06}).to(c,{autoAlpha:0,duration:.3},"-=.2").set(droppable,{pointerEvents:"all"})},deleteItem=e=>{const t=e.target.parentNode,a=t.querySelectorAll(":scope > *"),o=gsap.timeline({onComplete:()=>{t.remove();const e=document.querySelector(".item");e||dragtl.reverse()}});o.to(a,{autoAlpha:0,y:-10,duration:.2,stagger:.1}).to(t,{height:0,paddingTop:0,paddingBottom:0,duration:.5},"-=.15")};var inputObj=document.getElementById("_ef");list.onclick=function(){inputObj.click()},inputObj.onchange=function(){var e=this.files[0];if(window.FileReader){var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(t){itemMarkup(e,t.target.result,50,50)}}};